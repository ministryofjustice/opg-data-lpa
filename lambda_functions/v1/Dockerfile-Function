FROM python:3.13-alpine3.23 AS build

RUN apk add --no-cache autoconf automake cmake make g++ elfutils-dev libcurl libtool

WORKDIR /app

COPY lambda_functions/v1/requirements/requirements.txt requirements.txt

RUN pip install -r requirements.txt -t python/

COPY lambda_functions/v1/functions/lpa/ python/

FROM python:3.13-alpine3.23 AS runtime

WORKDIR /var/task

COPY --from=build /app/python ./

RUN rm -f /usr/local/bin/aws-lambda-rie

ENTRYPOINT [ "/usr/local/bin/python", "-m", "awslambdaric" ]
CMD [ "app.lpa.lambda_handler" ]
