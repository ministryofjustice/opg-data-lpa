FROM python:3.13-alpine3.23 AS build

RUN apk add --no-cache autoconf automake cmake make g++ elfutils-dev libcurl libtool

WORKDIR /var/task

COPY /functions/lpa/ /var/task/lambda_functions/v1/functions/lpa
COPY /tests/  /var/task/lambda_functions/v1/tests
COPY requirements/requirements.txt requirements.txt
COPY requirements/dev-requirements.txt dev-requirements.txt

RUN pip install --upgrade pip
RUN pip install \
        --target /var/task \
        -r requirements.txt \
        -r dev-requirements.txt
RUN pip install coverage==7.5.0

ENV PYTHONPATH "${PYTHONPATH}:/var/task"

COPY --chmod=755 run-tests.sh run-tests.sh

ENTRYPOINT ["sh", "./run-tests.sh" ]
